services:
  wg-easy:
    image: ghcr.io/wg-easy/wg-easy:14
    container_name: wg-easy
    restart: unless-stopped
    cap_add:
      - NET_ADMIN
      - SYS_MODULE
    sysctls:
      - net.ipv4.ip_forward=1
      - net.ipv4.conf.all.src_valid_mark=1
    environment:
      LANG: en
      WG_HOST: ${WG_HOST}
      PASSWORD_HASH: ${PASSWORD_HASH}
      WG_DEFAULT_DNS: ${WG_DEFAULT_DNS}
      WG_DEFAULT_ADDRESS: ${WG_DEFAULT_ADDRESS}
      WG_POST_UP: >
        iptables -A FORWARD -i wg0 -j ACCEPT;
        iptables -t nat -A POSTROUTING -o wg+ -j MASQUERADE;
        iptables -t nat -A PREROUTING -i eth0 -p udp --dport 42780 -j DNAT --to-destination 10.8.0.10:42780;
      WG_POST_DOWN: >
        iptables -D FORWARD -i wg0 -j ACCEPT;
        iptables -t nat -D POSTROUTING -o wg+ -j MASQUERADE;
        iptables -t nat -D PREROUTING -i eth0 -p udp --dport 42780 -j DNAT --to-destination 10.8.0.10:42780;
    volumes:
      - etc_wireguard:/etc/wireguard
    ports:
      - '51820:51820/udp'
      - '51821:51821/tcp'

      # Port Forwardded Ports
      - '42780:42780/udp'

volumes:
  etc_wireguard:
